{% extends 'test.html' %}

{% block navbar %}

  <div class="navbar">
    <div class="brand-title">MMU VR Group</div>
    <div class="nav-links">
      <a href="{% url 'chat:room' room_name=workspace.roomname %}">Meeting</a>
      <a href="{% url 'grouping:ranking' Room_join_code=workspace.join_code %}">Ranking</a>
      <a href="{% url 'login_signup' %}">Login</a>
    </div>
  </div>

{% endblock %}

{% block content %}
<div class="main-content">
  <div class="container">
    <h2>Workspace: {{ workspace.roomname }}</h2>

    <!-- Task creation form -->
    <form method="POST" class="row g-3 justify-content-center align-items-center mb-4">
      {% csrf_token %}
      <div class="col-md-4">
        <input type="text" class="form-control" name="task" placeholder="Enter a task here" required>
      </div>
      <div class="col-md-3">
        <select name="assigned_to" class="form-select">
          <option value="">Assign to...</option>
          {% for member in members %}
            <option value="{{ member.id }}">{{ member.username }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <input type="date" name="due_date" class="form-control">
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">Add Task</button>
      </div>
    </form>

    <!-- Task List as Table -->
    <table class="table mb-4">
      <thead>
        <tr>
          <th scope="col">Todo item</th>
          <th scope="col">Assigned to</th>
          <th scope="col">Due date</th>
          <th scope="col">Status</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for task in tasks %}
          {% if task.todo_name %}
          <tr>
            <td>{{ task.todo_name }}</td>
            <td>{{ task.assigned_to.username|default:"-" }}</td>
            <td>{{ task.due_date|date:"Y-m-d"|default:"-" }}</td>
            <td>
              {% if task.status %}
                <span class="text-success">Completed</span>
              {% else %}
                <span class="text-warning">In progress</span>
              {% endif %}
            </td>
            <td>
              {% if user in task.workspace.members.all %}
                {% if not task.status %}
                  <a href="{% url 'grouping:update' task.id %}">
                    <button type="button" class="btn btn-success btn-sm">Mark as Done</button>
                  </a>
                {% endif %}
                <a href="{% url 'grouping:task-detail' task.id %}">
                  <button type="button" class="btn btn-info btn-sm">Edit</button>
                </a>
                <a href="{% url 'grouping:delete' task.id %}">
                  <button type="button" class="btn btn-danger btn-sm">Delete</button>
                </a>
              {% endif %}
            </td>
          </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}